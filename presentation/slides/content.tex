%% Content of websecurity-document

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Psycho-sociological Aspects}

\subsection{Security concerns}

Internet consists of interconnected networks. These networks were developed in
a closed and trusted environment by the U.S. Department of Defense.
Security was not a concern. At this time, only a few research and government
sites were linked together to share data. Later, in the middle of the
eighties, the first real network security incident appeared: a German
spy, named Markus Hess, managed to get into the US military network and
stole information.

The Network then continued to grow to finally become the Internet as we know
it today, but security problems continued to appear in the same time. Both
aggressive and defensive technologies become more sophisticated.
Nowadays, internet is present everywhere in our electronic life: we use it
for our personal informations and leisures (YouTube, Facebook), for financial
management (online Banking, Tax-On-Web) and of course in our professional
lives (e-mail, calendars).

\subsection{Sentiment of security}

Security efforts are made to bring trust to users, sometimes giving them a
false sentiment of security. Web services need to gain some level of trust, still they
must not lure the users. Indeed, don't we believe that HTTPS websites could be
seen as fully secured web sites? In reality, they just prevent some of the
attacks.
Every web site should indeed earn the confidence of its users because
personal information will be shared on the network and it should be
unacceptable to see this data stolen because of a compromised web site.

\subsection{Users as a security flaw}

That's why security aspects require more specific measures, more guarantees and
a stronger protection against all kinds of attacks. But security is also a user's
responsibility. They can divulge their credentials, use unsecured web sites or
compromised software and they don't always understand what they do.

For example, each critical web service now requires to use a password.
But with a number of services getting more and more important, remembering
multiple passwords can become a hard task. A consequence is that most users use
the same password for several web sites or just write them down, for example
on post-its. More, these passwords are generally short and pass-phrases are
not common.
Some online passwords storage services exist to help tracking the password, but
these services are not always used.

\subsection{Security vs usability}

A compromise must be found between high security and usability.
This implies to make a choice between the usage of few or many security
measures, simple or more complex passwords, plain text or encoded data, etc.
It is easier to just use a service without worrying about anything, still
security checks and authorization are necessary to ensure that the data is
quite safe.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Attack}

\subsection{Attack trees}

We will start our study of different attacks by describing the attack tree model.
The attack tree describes how an asset can be attacked. In other words, this
kind of model is used to determine and understand threats that may arise.

\begin{figure}[htb]
\includeimage[width=\linewidth,height=6cm]{attack-tree-admin}
%\caption{Attack tree example}
\end{figure}

For an example, administration access can be obtained
thanks to the knowledge of the password. One way to get this password is to
steal it. To steal it we can either use social engineering or sniffing
techniques.
This reflection enable us to build an attack tree model showing threats
for the administration access.

\subsection{Threats}

Threats are numerous and diversified.
\begin{itemize}
\item Sole purpose to break thinks.
	These attacks can come from internet hackers or viruses but also from
	internal threats in your enterprise such as unsatisfied employees.
\item Obtaining a gain.
	That's the case with organized crime or competitors wanting
	to acquire financial or technical information.
\item Can simply be unintentional or accidental.
	Examples include: loss of electricity, software failure, hardware
	failure, but also natural disasters.
\end{itemize}

\subsection{Risk}

To understand the risk encountered by systems vulnerable to such attacks, let's
first define what is a risk.

\begin{quote}
A risk is the potential that a given threat will
exploit vulnerabilities of an asset or group of assets and thereby cause harm to
the organization. Is is measured in terms of a combination of the probability of
occurrence of an event and its consequence.
-- Wikipedia
\end{quote}
\[
   risk = likelihood * impact
\]
In other terms, the risk is the relation between vulnerability factors such as
\begin{itemize}
\item Ease of discovery
\item Ease of exploit
\item Awareness
\item Intrusion detection
\end{itemize}
and impact factors such as
\begin{itemize}
\item Loss of confidentiality, integrity, availability or accountability
\item Financial damage
\item Reputation damage
\item Privacy violation
\end{itemize}

\subsection{Context of web applications}

Basically, the web is based on a client-server model. The protocol used to
retrieve web pages is HTTP. Anyone can access a public server and send
requests.

In reality, the client is not directly connected to the server. A lot of
intermediaries are present, each of them plays a different role and an attack
can happen at any level.
For example, the client can be on a WiFi network that is connected to the
internet. The web server is on another network where other computers are
present: other clients, intrusion detection systems, databases, etc. In
between, we can find firewalls, demilitarized zones and others.
Any component may fail: whether the web site continues to work depends on the
duplication of components on the network. A single point of failure is a part
of the system such that when it fails the system stop to work properly.

\subsection{Technical introduction}

\subsubsection*{HTTP}

\begin{lstlisting}[style=beamer]
@GET@ @/wiki/Hypertext_Transfer_Protocol@ HTTP/1.1
Host: en.wikipedia.org
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:19.0) Gecko/20100101 Firefox/19.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
@Cookie@: mediaWiki.user.id=m5MFt3bI4Lr1GcMvj4rPk4mwtwZqTWhx; ...
Connection: keep-alive
...
\end{lstlisting}

A \emph{request} consists of a method (\texttt{GET}, \texttt{POST}, ...), a
resource path and options such as the host, the user-agent, cookies, etc.
The \emph{response} follows the same schema and is followed by the content.

HTTP is \emph{stateless}: no information is saved between requests.
To overcome this limitation, cookies were introduced. These are key-value data
stored on the client's computer. They are sent in each request and can be
defined in the response by the server.

To track clients, websites use a session ID cookie for each client.
It is a "unique number" generated when the user accesses the website for the
first time. There is still no guarantee that this number is unique, even if
conflicts are improbable.

\subsubsection*{Cryptography introduction}

\paragraph{Symmetric cryptography}
The goal of the encryption is to obtain a message in a way that is readable
only by the authorized parties.
This encryption can be symmetric, that is, a single key is used to encode and
decode the message.
\[ msg \xrightarrow{key} cipher \xrightarrow{key} msg \]
Symmetric cryptography algorithms are AES, DES, Twofish.

\paragraph{Asymmetric cryptography}
A private-public key pair is used to realize asymmetric encryption. The
message is encrypted with the public key and decrypted with the private key.
\[ msg \xrightarrow{key_{pub}} cipher \xrightarrow{key_{priv}} msg \]

Asymmetric cryptography algorithms are RSA, Diffie-Hellman, DSA.

\paragraph{Symmetric versus Asymmetric}

\begin{description}
\item[Symmetric]
faster, need a pre-shared key and all the people holding the key can
decrypt the message.
\item[Asymmetric]
slower but does not need a pre-shared key, messages can be decrypted by the
person holding the right key.
\end{description}

The usual usage is to use asymmetric algorithm to exchange keys and then
symmetric algorithm is used for the rest of the connection as it is faster.

By definition, the public key is shared.
To encrypt a message, you use the recipient's public key. This way he is the
only one who can decrypt it. The signature is made using your private key.

A Public Key Infrastructure (PKI) can be used to distribute public keys in a
secure way. The role of the PKI is to validate the identity of the owner of
the key.

\subsection{Open Web Application Security Project (OWASP)}

A worldwide organization known as \href{https://www.owasp.org/}{Open Web
Application Security Project} (OWASP) focuses on improving the security of
software through the publication of standards, libraries and books.

\subsection{Top 10 of most critical web applications risks}

OWASP provides a top ten of most critical web applications risks.
\begin{enumerate}
\item Injection
\item Cross-site scripting (XSS)
\item Authentication and Session Management
\item Insecure Direct Object References
\item Cross-site Request Forgery (CSRF)
\item Security Misconfiguration
\item Insecure Cryptographic Storage
\item Failure to Restrict URL Access
\item Insufficient Transport Layer Protection
\item Unvalidated Forwards and Redirects
\end{enumerate}

\subsubsection{Injection}

\emph{Injection} is the mechanism consisting in sending untrusted data to an
interpreter. In other words, hackers enter code directly into input fields of
a web form that is executed on the server.
This is a very common attack, easy to exploit, and can produce a huge impact
such as data loss, data corruption and lack of accountability.

\includeimage[width=0.5\linewidth]{client-server-injection}

To avoid such security flaws, it is recommended to use a parametrized
interface (see \autoref{lst:parametrized-interface}), escape routines or to
use white-list validation to specify valid input patterns.
Black lists are discouraged, because it is easier to forget some rule and
it is often possible to use workarounds.
Usually, this vulnerability is present when the code to execute is built using
simple concatenation.

\begin{lstlisting}[style=beamer,
	caption={Parametrized interface in Java},
	label=lst:parametrized-interface]
String query = "select * from users where @user_name = ?@";
PreparedStatement st = con.prepareStatement(query);
@st.setString(1, name);@
ResultSet rs = st.executeQuery();
\end{lstlisting}

\subsubsection{Cross-site scripting (XSS)}

\emph{Cross-site scripting} is an attack consisting in code injection directly
into the page that will be sent to the user.
This code can be a script that will finally be interpreted by the browser.
This kind of attack requires some knowledge from the attacker but impacts are
generally moderated.
However, this is the most widespread vulnerability on the web.

\includeimage[width=0.5\linewidth]{client-server-xss}

Possible attacks include session hijacking, the change of a page content or
user redirection to another web site. Once again, using escaping routines
before sending values to the users or using white list validation prevents
this attack.

\begin{lstlisting}[style=beamer,
	caption={XSS test},
	label=lst:xss-input]
Hello @<script>alert("Hello world!");</script>@ world!
\end{lstlisting}

\subsubsection{Authentication and Session Management}

The use of flaws in authentication and session management
implemented for a given web site to steal someone else's identity using
session hijacking or session fixation. This type of attack is very
common and impacts are often important. Indeed, with the identity of someone
else, the attacker can do anything the real user can do.

To avoid this kind of attack, a few "good practices" should be used. First do not
forget to log out on public computer because your session could be easily used
by someone else. The use of session timeout and visible
log out buttons are also "good practices". Then, it is important to prevent
the use of cross-site scripting
attack because a session ID could be easily stolen thanks to this mechanism.

For example, session hijacking consist in stealing the session ID of another
user through the use of an attack like XSS. Session fixation consists in
forcing a user to use a particular session ID; it is sometimes possible to
inject the session ID into the URL.

\subsubsection{Insecure Direct Object References}

Insecure direct object references consists in changing a parameter in the URL
so that another entity or document shared by the web site could be accessed.
For example by replacing an identifier into the request referencing an
accessible object by another identifier referencing an initially non accessible
object. This kind of attack is very simple to exploit and can compromise
referenced data.

\begin{lstlisting}[style=beamer]
http://example.com/user/@152@
\end{lstlisting}

To bring more security, source code in web applications should
always check whether the user has the rights to access the object before
manipulating it.

\subsubsection{Cross-site Request Forgery (CSRF)}

Cross-site request forgery is a mechanism that consists in generating requests
when a user, the victim, visits the attacker's web page. The visited web page
contains malicious code that can submit requests to the attacked web site
using the visiting user's identity.
This is a widespread attack but fortunately easy to detect.

\includeimage[width=0.5\linewidth]{client-server-csrf}

CSRF can be countered using a simple technique:
each request should contain an unique token linked to the user's session. This
way, the attacker's website will not be able to generate the correct requests,
and so, will be unable to act as the victim.

\begin{lstlisting}[style=beamer,
	caption={A protected form against CSRF}]
<form @method="post"@ action="addComment">
	<input @type="hidden"@ name="token" @value="<random>"@ />
	...
</form>
\end{lstlisting}

\subsubsection{Security Misconfiguration}

Security flaws can also appear through security misconfiguration. Default
configuration used for application, server or database are not necessarily a
good choice. It could be possible to gain information such as versions,
stack traces or debug messages that can lead to bigger threats which could
compromised the whole system (gain unauthorized access, use known bugs to hack
an application, etc.).

Keeping an up-to-date system is the first recommendation to prevent such
attacks. In combination with a good separation between components, the systems
will be only partially affected.

\subsubsection{Insecure Cryptographic Storage}

Sensitive data should be stored securely.
When an attacker gains access to the data, a cryptographic barrier should be
used to prevent the attackers from reading it. Unencrypted data will be
compromised. This kind of attack is fortunately quite difficult to perform for
attackers.

For example, a lost unencrypted backup of the database would contain all the
information for the attacker.
Also, information such as passwords must be hashed and a salt should be
applied to prevent rainbow table attacks.

\subsubsection{Failure to Restrict URL Access}

A missing URL access restriction is always a vulnerability.
Attackers can change their URL to switch to a privileged page with functions
requiring permissions.
This is a quite uncommon flaw but it is easy to exploit. The main impact is of
course the threat to give administrative functions to the attackers.

To prevent this attack, authorisation mechanisms should be used even if
pages are not necessarily referenced from any other page.

\subsubsection{Insufficient Transport Layer Protection}

It is possible to capture traffic between a client and a server.
Insufficient transport layer protection is the lack of encryption mechanisms
when sensitive data is being sent.
Examples of common attacks are sniffing a WiFi network, scanning for HTTP
requests or even analysing conversations.

HTTPS can secure connections using SSL/TLS. Secure cookies will not be sent
through an unencrypted connection and certificates will be verified by the
browser to ensure their validity.

\subsubsection{Unvalidated Forwards and Redirects}

The last attack implies unvalidated forwards and redirects. This means that an
URL may appear as trustworthy but actually contain unvalidated redirect to an
unsecure page or it can contain a forward attempting to bypass authorization
functionalities. This is an easy attack to detect and nowadays a rarely
present kind of attack.

A barrier against these attacks is to avoid redirects and forwards as much as
possible, and in the case when this is not possible, to validate and authorize
the user after each redirection or forward.

\subsection{Other common attacks}

Besides these attacks listed by the OWASP organization, we can also mention
other common attacks. Here are a few of them.

\subsubsection{Denial of service}

The attack by denial of service aims to bring down (or at least make
unavailable) some service usually by causing server overload.

\begin{description}
\item[SYN flood]
When a client initiates a connection with a server, it sends a SYN request.
The server then sends a confirmation (ACK) to the client that the connection
is accepted and the client terminates this three-way handshake by responding
to the server with an acknowledgment (SYN-ACK).
A SYN flood attack consists in sending a huge quantity of SYN
requests without responding to the server with an acknowledgment. This way, the
server uses more and more resources but never frees them, causing either a denial
of service or, for the worst case, a crash.
\item[Application level flood]
Request can be sent to the server to initiate cpu-intensive tasks or to save
lot of data causing the disks to become full.
\item[R-U-Dead-Yet]
The attack consists in sending data very slowly to the server. This is similar
to a SYN flood, but the connection stays alive.
\item[DDoS] (Distributed Denial Of Service)
Follows the same principle as a traditional Denial Of Service attack but it is
launched by several attackers in the same time.
\item[Unintentional DoS]
A web site ends up denied not because of a deliberated attack but because of a
sudden peak of popularity.
\end{description}
Using firewalls as well as Intrusion Prevention System can reduce the risks to
be a victim of this kind of attack.

\subsubsection{Man in the middle}

Another well known attack is the man in the middle attack. The
attacker plays the role of the server to the client and the role of the client
to the server. This way, all communications transit through the attacker who can
modify messages as they are sent. The victims believe they use a private
connection but the attacker, the man in the middle, controls the whole exchange.

\subsubsection{Social engineering}

A less technical but nevertheless damaging attack is the use of social
engineering. Social engineering simply consists in manipulation people so they
divulge confidential information. Different scenarios are used by attackers in
social engineering to achieve their goal. Pretexting is one of them and consists
in using invented scenario to engage a targeted victim in a manner that
increases the chance the victim will divulge information or perform actions
that would be unlikely in ordinary circumstances. Another technique is
\textit{quid pro quo}, which consists in helping some user while getting from
them confidential information such as passwords.

The only way to fight against social engineering is to educate users and use a
framework of trust.

Another kind of social engineering attack is phishing, which is described in
the next section.

\subsubsection{Phishing}

Phishing is the attempt to acquire user information, such as passwords or credit
card details, through masquerading as a legitimate website. Tricks used can be
cloned websites, link manipulation or even phone phishing but most of the time
phishing is carried out by e-mail or instant messaging. Most of the time,
phishing e-mails contains links that redirect the user to malicious web sites.
Victims then enter their confidential information that are finally recovered
by the attacker.

\subsubsection{Brute force}

Brute force is an attack whose purpose is to try all possible combinations of
passwords to discover the right one. A dictionary attack is based on the same
principle, but only tries a list of common passwords.
This kind of attack is very sensitive to the length and the complexity of the
passwords. The longer the password, the more the attacker will have
difficulties to discover it.

\subsubsection{Path traversal}

The goal of this attack is to access files that are present on a server. It
is possible by browsing the application, looking for relative links to file on
the server. Then, by manipulating those file references, it may be possible to
access confidential or critical files stored into the server.

\begin{lstlisting}[style=beamer,
	caption={Getting a file from the server}]
http://example.com/forum/download.jsp?@path=/etc/shadow@
\end{lstlisting}

\subsubsection{Failure to restrict automation}

Often, web sites are not protected against automation. A program can launch
commands to execute functionalities as if it was a human being doing the
manipulation. The web server could be overloaded or spammed in this way.

To prevent this threat, a challenge-response test, called captcha, can be put
in place. A captcha generally ask a user to complete a simple test which is
difficult for a computer to answer. But captcha cracking stays possible.
Indeed, a malicious web site could present the same captcha existing on
another web site. Users surfing on the evil web site would crack unknowingly
the other web site's protection by giving the correct answer to the captcha.

Against overloading, a maximum number of requests per IP for a fixed time
period could be set up.

\subsection{Common points}

We can distinguish common points among these multiple attacks explaining why
such attacks should arise.

\begin{itemize}
\item Improper input validation is a redundant problem. The data can be used
	in many ways, at each step the data must be checked whether it is valid
	and must also be escaped when it is meant to be interpreted.
\item Missing authorization checks are always a problem.
\item Misconfigurations given more information for the attacker.
\item The education factor plays an important role in web security as we saw
	it with social engineering techniques.
\end{itemize}

As we can see, many forms of attacks exist and, as technology evolves, new
attacks appear. So, instead of trying to fix vulnerabilities, we should focus
on establishing strong security controls.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Authentication and identity}

The \emph{identity} of somebody is who they claim to be.
The \emph{authentication} is the act of asserting the identity of something or
someone.
Authentication is needed when you want to transmit confidential
information, you want to be sure that your correspondent isn't
impersonated by somebody else.
The \emph{authorization} is the act of determining whether the user has the
permission to perform some action.
Beware that authentication by itself does not imply confidentiality.

\subsection{Types of authentication}

\subsubsection{Password}
This is the most common form of authentication.
Passwords must have a sufficient complexity and must be easy to change
periodically.
Complexity has to be checked on both client and server side.
People should use different passwords for different services.

\subsubsection{One time Passwords}
One time passwords are used to prevent replay attacks.
The main difficulty of this technique is to give users their passwords
(logistical problem).
This technique is used mainly by services who can afford big infrastructures
(banks, states,\ldots).

\subsubsection{Signatures}
The signature is the encrypted hash of a message.
The hash is a fixed size string built using an irreversible function from a
message.
The signature is then a mean to authenticate the identity of the sender of a
message.

\subsubsection{Challenge}
A challenge use a nonce, this stands for number used once.
It's a random number used once to avoid replay attack.
The nonce is encrypted with the correspondent's public key and he is then
asked for the decrypted and encrypted message.
This form of authentication is often used to sign online transactions.

\subsubsection{Certificates}
A trusted authority issues certificates to confirm the identity of something.
They are used in SSL or TLS.
Only one participant of the conversation can be certified (client or server)
or both.
Certificates are often used as a mean to distribute keys in a PKI. A typical
example is for SSL/TLS in web browsers. A CA is a Certification Authority, an
entity that issues digital certificates.
\begin{itemize}
\item Each CA does generate its public-private key pair. They self-sign their
certificates with their public key
\item Browsers are distributed with some pre-installed certificates. You can
also add them manually
\item When websites want to sign a message, they sign it with their private
key and send the signed object and their certificate
\item The browser checks the certificates against the CA certificate and the
message against the checked certificate
\end{itemize}

\paragraph{How to obtain a certificate ?}
When a website owner wants a certificate, he generates a public-private key
pair and then sends it to a CA.
The CA checks the integrity of the request and performs some checks on the
identity of the owner. Finally, it signs the certificate.

\subsubsection{Token}
Something which ownership gives a form of identification.
For example: Keys, Bank cards, Badges, Digipass, ...

\subsubsection{2-factor authentication}
Identify the entity using multiple authentication methods.
This way, if one method is compromised, the attacker will not still be able to
log into the system.
The authentication methods are the following:
\begin{itemize}
\item What it \emph{is} (biometrics)
\item What it \emph{owns} (bank card,...)
\item What it \emph{knows} (password, pin code,...)
\end{itemize}

\subsection{Single Sign-On}
\begin{quote}
The SSO is a property of access control of multiple related but independent
software systems. With this property a user logs in once and gains access to
all systems without being prompted to log in again for each of them.
-- Wikipedia
\end{quote}

\begin{description}
\item[Pro]
\hfill
\begin{itemize}
\item Easier for the user
\item Implementation already exist
\item If they have only one password, users tend to treat it with more care
\item Enter the password less often
\end{itemize}
\item[Cons]
\hfill
\begin{itemize}
\item All your eggs in the same basket (impact greater if compromised)
\item You are dependent upon your provider (confidence, availability,\ldots)
\end{itemize}
\end{description}

\subsection{Kerberos}
Kerberos is a SSO implementation developed at MIT to solve the problem of
allowing some users to use restricted resources. MIT provides a free
implementation of the protocol but it's also found in many commercial
products.

\paragraph{How it works}
\begin{enumerate}
\item The client gets a ticket from a distribution center to authenticate itself
\item The client gets a service ticket
\item The service ticket can be used on another server
\end{enumerate}

\subsection{Provider extensions}
Common SSO used over the web:
\begin{itemize}
\item \href{http://www.facebook.com/}{Facebook account}
\item \href{http://google.com/}{Google}
\item OpenID (\href{http://myopenid.com/}{myOpenID},
\href{http://claimid.com/}{ClaimID},
\href{http://pip.verisignlabs.com/}{VeriSign}, etc.)
\end{itemize}
These organisations provide single sign-on to other websites for free
using a dedicated API which is much simpler than devising your own
sign-on mechanism.

\subsection{Compromised authentication}
When you implement authentication you have to take into account that the user
may lose its authentication mean or it can get stolen.

The process for revoking the authentication is the following:
\begin{enumerate}
\item Deactivate a compromised authentication mean
\item Authenticate the user with a still safe mean
\item Give the user a new primary authentication mean
\end{enumerate}

\subsubsection*{Password recovery}
Still a usability versus security trade-off.
How to do it properly?
\begin{enumerate}
\item Use of security question or other strong authentication
\item Send a token over a side channel
\item Allow the user to change password
\item Confirm change
\end{enumerate}
Beware that an attacker may use social engineering to get answers to security
questions.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Prevention}

\subsection{Different moments}

Preventing security flaws is something that has to be done during the
whole life cycle of the application.

\subsubsection{Architecture}

Integrate a security review into your architecture design process. Start
early on, and as your design changes, review those changes with the
steps given in this chapter.
Evolve your security review. To complete the review
process, you might also need to add specific questions that are unique
to your application.
Know the threats you are reviewing against. List the threats that affect the
various components and layers that make up your application.
Knowing these threats is essential to improving the results of your review process.
There is no miracle receipt when it comes to designing a secure
application. Although there are some guidelines which can help you. You
have to ask yourself the good questions and make decisions on a case by
case basis.

\begin{itemize}
\item Who are the end-users?
\item In what environment will the application run?
\item Who has access to the data?
\item Are there other systems that access data? What are the rules?
\end{itemize}

\subsubsection{Development}

There are lots of best practices that can make your application more secure.
\begin{itemize}
\item Passwords: enforcing a minimum complexity policy, storing them securely,
having the user rotate them, preventing brute-force by implementing temporary
lock-out,\ldots
\item Session management: setting an inactivity time out, setting the
secure-flag for sensitive cookies, using the HTTP-Only flag for cookies,
implementing an easily accessible logout,\ldots
\item Input validation: always on server side, use a positive
  approach: instead of forbidding some inputs, define the set of
  allowed input (usually through the use of regexp)
\item Use ad-hoc protection for known attacks. Ad-hoc protection means a
protection specialized for a particular attack in this context.
\end{itemize}

However, a secure development cycle should set aside some time for:
\begin{itemize}
\item Code review (security-oriented and general)
\item Pentesting
\item Security training of the developers
\item Sensitizing business owners to security trade-off
\item Choosing a secure and well maintained framework
\item Devising a secure configuration for deployment
\end{itemize}

\subsubsection{Maintenance}
When vulnerabilities have been discovered they have to be patched as soon as
possible. Beware of regressions and new security breaches; this is where
automated testing comes in.

\paragraph{Virtual patching}
\label{sec:virtual-patching}
Virtual patching is a security policy layer that prevents the exploitation of
a known vulnerability until a patch is released.
It does so by filtering the traffic that goes to and from the application
server and blocking requests that are exploits.

\subsection{Using frameworks}

You do not develop the first web application. Frameworks already exists to
ease the development of your application while providing several security
mechanisms.
A framework will come generally with authentication support, escaping of
values and standard input validation.

However, when a bug is found in a framework, all the web sites that use the
framework are affected. Changing a framework may prove difficult as the
written code may be coupled to the framework or follow the conventions used by
that framework.

Examples of frameworks include Spring (Java) or OWASP which provides an Enterprise
Security API that defines a security API for various languages.

\subsection{Security in application servers}

Application servers offer various services that can help you to configure
secured web applications.
Often the following aspects are configurable: authentication management,
directory listing, user session management, error handling, input encoding,
etc.

\subsection{Web Application firewall}

Application firewall are filters which inspect the traffic that comes
from and goes to your application and is able to block inappropriate
content.
They provide an additional layer of protection, for example, against
SQL injection by scanning parameters for SQL content.
Also, an application firewall can detect connection patterns (see IDS).
They can be used to patch security holes of applications which aren't
modifiable for some reason (\autoref{sec:virtual-patching}).

\subsection{HTTPS}

\textbf{TLS} (Transport Layer Security) is the successor of \textbf{SSL}
(Secured Socket Layer).
They are equal in terms of security.
HTTPS provides \emph{encryption} and \emph{authentication} for HTTP.
\newline Protects against eavesdropping and spoofing.
HTTPS is a part of a solution, it does not ensure full security.
TLS is an open-community standard and allows both secure and unsecure
communications.

\subsection{Browser restrictions}

Nowadays, browsers come with preconfigured security measures.

\begin{itemize}
\item Cross-domain XMLHttpRequests (XHR) are blocked.
	Browsers disallow contacting other domains through the use of JavaScript.
	A website can ask the browser to lift selectively this restriction via the
	header \texttt{Access-Control}.
\item Some browsers allow to block (selectively) the execution of JavaScript,
	Flash, or other plug-ins to protect the user against malicious code hosted
	by those sites.
\item A \emph{private navigation} mode is often present which prevents the browser
	from storing data on disk.
\item Cookies are stored on the user's computer; access to them is limited by
	the URL and the time stamp marks the validity expiration.
\item Multiple opened pages are sandboxed: isolated from other pages to
	prevent accessing data in between websites visited by the client.
\item Validation of SSL certificates is done.
\item Some provide a blacklist of known rogue web sites.
\end{itemize}

\subsection{E-mail}

E-mail is one of the most used application. It's plagued by spam and
spoofing. Some defensive measures have been taken.

\subsubsection{Sender Policy Framework}
SPF validates e-mails by verifying sender's IP address against DNS records.
Administrators can define allowed hosts for some domain.

\subsubsection{Domain Keys Identified Mail}
DKIM associates domain names and e-mail messages using a digital signature
added to the header of messages, a public key is added to the DNS record of
the domain for the recipient to read the message's header.

\subsection{Variety of environments}

The variety of environments available to the users leads to
difficulties when it comes to testing possible setups for
vulnerabilities.

We have different servers and their configurations, networks (proxy, caches,
etc.), browser clients, mobile clients, machine clients (machine to machine
communication) and so on.
Moreover some browsers (e.g. IE6) require workarounds to
display pages correctly which extend the amount of code and thus
increase vulnerability likeliness.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Detection}

\subsection{Penetration testing}

To find security holes in a system, penetration testing, or \emph{pentesting}, is a
method used to attack this system with the consent of the owner, using both
external and internal attackers. The goals of penetration testing are:
\begin{itemize}
\item Identifying vulnerabilities
\item Exploiting vulnerabilities
\item Testing the ability to detect and respond to an attack
\item Using social engineering
\end{itemize}

Several tools have been designed to perform these tasks.
Here are some of them:
\begin{itemize}
\item \textit{Nmap} (abbreviation for Network Mapper) is a free open source tool
	dedicated for network discovery and security auditing. Nmap suite includes
	a port scanning tool, a packet generation and response analysis tool as
	well as a scan results comparator tool.  It is nowadays one of the most
	popular security tool, distributed with many open source operating systems
	and supported by a large community of users and developers.
\item \textit{Metasploit} is able to identify security vulnerabilities and
	automates assessments.
\item \textit{Nessus} is a proprietary vulnerability scanner. A vulnerability
	scanner is a tool designed to detect computers, systems, networks and
	applications weaknesses.
\item \textit{WebScarab} is a web security application testing tool, developed
	by OWASP, which serves as an intercepting proxy.
	It is able to intercept web browser requests and web server
	responses. A WebScarab user will then be able to capture and modify
	requests exchanged between the client and the server.
\end{itemize}

\subsection{Honeypot}

Internet provides a way to detect and counteract attacks upon systems thanks to
dedicated assets. Those traps are called \emph{Honeypots}. A Honeypot is a mocked
website or web application running on a non patched server and that is exposed
for attackers who try to penetrate some systems.

Honeypots can be distinguished in two types: production honeypots and research
honeypots. The first group refers to honeypots used by organizations. They use
production honeypots to improve their overall state of security by capturing
limited information. The second category concerns research honeypots. They are
used to give a company informations about the motivations and tactics of the
attackers by capturing much more information than a production honeypot,
showing how to better defend itself against these attackers, but do not add
direct value to an organization.

Project Honey Pot is an anti-spammer project. Websites can publish fake
e-mails addresses for the spammers to be lured and once the spammer's crawlers
have sent emails to these addresses, they are referenced and blocked.

\subsection{Network Intrusion Detection System}

Network Intrusion Detection Systems (NIDS) are systems that can scan network
activity and try to detect attacks.

For example, \textit{Snort} is a NIDS and can detect attacks
and take actions accordingly. Among those attacks, Snort can perform
signature-based detection, which means it can find patterns in packets on the
network, detect SQL injection or XSS attacks. Snort can also perform
statistical anomaly-based detection. It looks for peaks in traffic, connection
coming from a single host and other anomalies or detects brute force attacks.
In the end, Snort can realize stateful protocol detection to catch SYN port
scans or follow a protocol conversation.

\subsection{Post-mortem analysis and performances}

When an attack is detected on a system, several questions can be asked to try
to solve the problem:
\begin{itemize}
\item When did the attack happen?
\item Is the attack still in progress?
\item Was the data compromised or modified?
\item Which systems failed to work?
\item How to fix the problem?
\item How to prevent future attacks?
\end{itemize}

But now, how to discover whether an attack happened? A first clue could be to read
traffic logs and graphs as well as application logs. Looking for peaks in the
server load or traffic could show an anomaly.
In combination, using analysis tools such as ntop, Snare or OSSEC can also help
to detect attacks:
\begin{itemize}
\item \textit{Ntop} is traffic monitoring platform designed to probe network usage.
\item \textit{Snare} (abbreviation for System iNtrusion Analysis and Reporting
	Environment) is a tool created to audit log data and to centralize log
	analysis coming from different applications or operating systems.
\item \textit{OSSEC} is an open source NIDS that can perform various tasks such as log
analysis supporting multiple formats, file integrity checking, policy
monitoring, rootkit detection and intrusion detection.
\end{itemize}

However, looking for a particular attack can mask another one which would serve
as a diversion for the real attack. Denial of service can be used to generate a
lot of traffic and can mask other attacks as generated logs become huge. In the
field of threat detection and analysis, testing performances can also be used
to detect possible attacks. Indeed, slow response time and high load might be
symptoms of an attack.
