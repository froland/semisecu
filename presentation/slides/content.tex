%% Content of websecurity-document

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Psycho-sociological Aspects}

\subsection{Security concerns}

Internet consists of interconnected networks. These networks were developed in
a closed and trusted environment by the U.S. Department of Defense.
Security was not a concern. At this time, only a few research and government
sites were linked together to share data. Later, in the middle of the
eighties, the first real network security incident appeared, causing several
computer to crash down. Among those were research and government sites.
% TODO what security incident

The Network then continued to grow to finally become the Internet as we know
it today, but security problems continued to appear in the same time. Both
aggressive and defensive technologies become more sophisticated.
Nowadays, internet is present everywhere in our electronic life: we use them
from our personal informations and leisures (YouTube, Facebook), for financial
management (online Banking, Tax-On-Web) and of course in our professional
lives (e-mail, calendars).

\subsection{Sentiment of security}

Security efforts are made to bring trust to users, sometimes giving them a
false sentiment of security. They need to gain some level of trust, still they
must not lure the users. Indeed, don't we believe that HTTPS websites could be
seen as fully secured web sites? In reality, they just prevent some of the
attacks.
Every web site should indeed earn the confidence of its users because
personal information will be shared on the network and it should be
unacceptable to see this data stolen because of a compromised web site.

\subsection{Users as a security flaw}

That's why security aspects require more specific measures, more guarantees and
a stronger protection against all kinds of attacks. But security is also a user's
responsibility. They can divulge their credentials, use unsecured web sites or
compromised software and they don't always understand what they do.

For example, each critical web service now requires to use a password.
But with a number of services getting more and more important, remembering
multiple passwords can become a hard task. A consequence is that most users use
the same password for several web sites or just write them down, for example
on post-its. More, these passwords are generally short and pass-phrases are
not common.
Some online passwords storage services exist to help tracking the password, but
these services are not always used.

\subsection{Security vs usability}

A compromise must be found between high security and usability.
This implies to make a choice between the usage of few or many security
measures, simple or more complex passwords, plain text or encoded data, etc.
It is easier to just use a service without worrying about anything, still
security checks and authorization are necessary to ensure that the data is
quite safe.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Attack}

\subsection{Attack trees}
We will start our study of different attacks by describing the attack tree model
which give a description of how an asset can be attacked. In other words, this
kind of model is used to determine and understand threats that may arise on a
system. For an example, administration access to a database can be obtained
thanks to the knowledge of the password. One way to get this password is to
steal it. To steal it we can either use social engineering or sniffing
techniques. This reflection able us to build an attack tree model showing threats
for the administration access asset. Threats are numerous and diversified and we
can distinguish several reasons to these attacks: \begin{itemize}{} \item
Threats can exists with the only purpose to break thinks. These attacks can come
from internet hackers or viruses but also from internal threats in your
enterprise such as unsatisfied employees. \item The second category of threats
has a different purpose which is to obtain a gain. That's the case with
organized crime or competitors wanting to acquire financial or technical
information. \item Last but not least, threats can simply be unintentional or
accidental such as loss of electricity, a software failure, a hardware failure
but also due to a natural disaster. \end{itemize}

To understand the risk encountered by systems vulnerable to such attacks,
let's first define what is a risk. A risk is the potential that a given threat
will exploit vulnerabilities of an asset or group of assets and thereby cause
harm to the organization. Is is measured in terms of a combination of the
probability of occurrence of an event and its consequence (Wikipedia). In
other terms, the risk is the relation between the probability of a successful
attack on an asset and the damages caused by this attack such as the loss of
confidentiality, integrity, availability and accountability, but also some
financial or reputation damages or even privacy violation.
Web applications are particularly sensitive to these attacks. Indeed, the
context of execution of web applications is quite complex and implies a lot of
components: browser, router, firewall, application server or database. A
single point of failure from one of these components would prevent the entire
system from correctly working. A worldwide organization known as OWASP (Open
Web Application Security Project) focuses on improving the security of
software through the publication of standards, libraries and books. They also
provided a top ten of most critical web applications risks. From higher risk
to lower risk we can find:
\begin{itemize}{}
\item Injection
\item Cross-site scripting (XSS)
\item Authentication and Session Management
\item Insecure Direct Object References
\item Cross-site Request Forgery (CSRF)
\item Security Misconfiguration
\item Insecure Cryptographic Storage
\item Failure to Restrict URL Access
\item Insufficient Transport Layer Protection
\item Unvalidated Forwards and Redirects
\end{itemize}

Let's study each security flaw listed above, their risks, their impacts and
how they can be prevented using adapted mechanisms.

\subsubsection{Injection}
First of all, "Injection" is the mechanism consisting in sending untrusted
data to an interpreter. In other words, hackers enter code to execute directly
into input fields of a web form. That is a very common attack, easy to
exploit, that can produces a lot of impacts such as data loss, corruption or
even lack of accountability. To avoid such security flaws, it is recommended
to use a parametrized interface, to escape routines and to use white list
validation to specify valid input patterns.

\subsubsection{Cross-site scripting (XSS)}
Cross-site scripting is an attack consisting in code injection directly into
the page that will be sent to the user. This code can be a script that will
finally be interpreted by the browser. This kind of attack requires some
knowledge from the attacker but impacts are generally moderated. Let's include
the hijack of a user session, the change of a page content or also the user
redirection to another web site. Once again, using escaping values before
sending them to the users or using white list validation can reduce risks
against this kind of attack.

\subsubsection{Authentication and Session Management}
Our third attack is the use of flaws in authentication and session management
implemented for a given web site to steal someone else's identity such as a
session hijacking or a session fixation. This can be possible, for an example,
by using a stolen session id directly into the URL. This type of attack is
very common and impacts are often important. Indeed, with the identity of
someone else, the attacker can do anything the real user can do. To avoid this
kind of attack, a few practices should be used. First do not forget to log out
on public computer because your session could be easily used by someone else.
A good practice is also to use session timeout and visible log out buttons.
Then, it is important to prevent against cross-site scripting attack because a
session id could be easily stolen thanks to this mechanism.

\subsubsection{Insecure Direct Object References}
Insecure direct object references is an attack that requires changes in the
URL request to obtain a direct object reference that should not be able to
access. For example by replacing an identifier into the request referencing an
accessible object by another identifier referencing an initially non
accessible object. This kind of attack is very simple to exploit and can
compromise referenced data. To bring more security, source code in web
applications should always checks if the user has the rights to access the
object before manipulating it.

\subsubsection{Cross-site Request Forgery (CSRF)}
Cross-site request forgery is a mechanism that consists in generating requests
when a user, the victim, visits the attacker's web page. The visited web page
then contains malicious code that can submit requests to the attacked web site
using the visiting user identity. This is a widespread attack but fortunately
easy to detect. To counter it, each request should contains an unique token
linked to the user session. This way, the attacker's website will not be able
to generate the correct requests, and so, will be unable to act as the victim.

\subsubsection{Security Misconfiguration}
Security flaws can also appear through security misconfiguration. Default
configuration used for application, server or database are not necessarily a
good choice. It can let the possibility to gain information such as versions,
stack traces or debug messages that can lead to bigger threats which could
compromised the whole system (gain unauthorized access, use known bugs to hack
an application, etc). Keeping an up-to-date system is the first recommendation
to prevent such attacks. In combination, a good separation between components
is also more secure.

\subsubsection{Insecure Cryptographic Storage}
Insecure cryptographic storage is the next threat. Most sensitive data are
indeed generally stored insecurely without encryption. Gaining access to data is
the first step but once it is done, a cryptographic barrier should be used to
prevent attackers to read it. Risks are high for unencrypted data which will
be compromised. This kind of attack is fortunately quite difficult to perform
for attackers.

\subsubsection{Failure to Restrict URL Access}
Another threat implies missing URL access restriction. Attackers can change
their URL to switch to a privileged page with functions requiring
permissions. This is a quite uncommon flaw but easy to exploit. Main impact is
of course the threat to give administrative functions available to the
attackers. To bring more security, authorisation mechanisms should be used
even if administration pages are not necessarily referenced from any other
page.

\subsubsection{Insufficient Transport Layer Protection}
Next case concerns insufficient transport layer protection which is the
possibility for an attacker to sniff the data over the network to access it.
Examples of common attacks are sniffing a WiFi network, scanning for HTTP
requests or even analysing conversations. Any sniffer can be used to sniff a
network, however, results are often difficult to exploit. HTTPS protocol can
secure connections using SSL/TLS. Secure cookies will not be sent through an
unencrypted connection and certificates will be verify to ensure their
validity.

\subsubsection{Unvalidated Forwards and Redirects}
The last attack implies unvalidated forwards and redirects. This means that an
URL may appear as trustworthy but actually contains unvalidated forward or
redirect giving the opportunity to the attacker to bypass authorization
functionalities. That's an easy attack to detect and nowadays a rarely
present kind of attack, impacting victims  into disclosing information or
permitting access control bypass. A barrier against these attacks should be to
avoid redirects and forwards as much as possible, and in the case if this is
not possible, to validate and authorize the user after each redirection.

Besides these attacks listed by the OWASP organization, we can also mentioned
other common attacks.

Denial of service is one of them. This attack aims to bring down (or at least
make unavailable) some service usually by causing server overload. Common
denial of service attacks are SYN flood, application level flood, DDoS or
unintentional DoS.

Another well known attack is the man in the middle attack. In this attack, the
attacker plays the role of the server to the client and the role of the client
to the server. This way, all communications transit through the attacker who
can modify messages as they are sent.

A less technical attack is social engineering. This attack simply consists in
manipulating people so they divulge confidential information. Different
scenarios are used by attackers in social engineering to achieve their goal.
Pretexting is one of them and consist in using invented scenario to engage a
targeted victim in a manner that increases the chance the victim will divulge
information or perform actions that would be unlikely ordinary circumstances.
The only way to fight against social engineering is to educate users and use a
framework of trust.

Phishing is the attempts to acquire user information through masquerading as a
legitimate website. Tricks used can be cloned websites, link manipulation or
even phone phishing.

Brute force is an attack whose purpose is to try all possible combinations of
a password to discover it. A dictionary attack is based on the same principle
but only try a list of common passwords.

As we can see, many forms of attacks exist and, as technology evolves, new
ones appear. So, instead of trying to fix vulnerabilities, we should focus on
establishing strong security controls.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Authentication and identity}

The identity of somebody/something is who/what he/it claims to be.
The authentication is the act of asserting the identity of something or someone.
Authentication is needed when you want to transmit confidential
information, you want to be sure that your correspondent isn't
impersonated by somebody else.
The authorization is determining whether the user has the permission to perform some action.
Beware that authentication by itself does not imply confidentiality.

\subsection{Cryptography introduction}

\subsubsection{Symmetric cryptography}
The goal of the encryption is to obtain a message in a way that is readable
only by the authorized parties.
This encryption can be symmetric, that is, a single key is used to encode and
decode the message.
\[ msg \xrightarrow{key} cipher \xrightarrow{key} msg \]
Symmetric cryptography algorithms are AES, DES, Twofish.

\subsubsection{Asymmetric cryptography}
A private-public key pair is used to realize asymmetric encryption. The
message is encrypted with the public key and decrypted with the private key.
\[ msg \xrightarrow{key_{pub}} cipher \xrightarrow{key_{priv}} msg \]

Asymmetric cryptography algorithms are RSA, Diffie-Hellman, DSA.

\subsubsection{Symmetric versus Asymmetric}

\begin{description}
\item[Symmetric]
faster, need a pre-shared key and all the people holding the key can
decrypt the message.
\item[Asymmetric]
slower but does not need a pre-shared key, messages can be decrypted by the
person holding the right key.
\end{description}

The usual usage is to use asymmetric algorithm to exchange keys and then
symmetric algorithm is used for the rest of the connection as it is faster.

By definition, the public key is shared.
To encrypt a message, you use the recipient's public key. This way he is the
only one who can uncrypt it. The signature is made using your private key.

A Public Key Infrastructure (PKI) can be used to distribute public keys in a
secure way. The role of the PKI is to validate the identity of the owner of
the key.

\subsection{Types of authentication}

\subsubsection{Password}
This is the most common form of authentication.
Passwords must have a sufficient complexity and must be easy to change
periodically.
Complexity has to be checked on both client and server side.
People should use different passwords for different services.

\subsubsection{One time Passwords}
One time passwords are used to prevent replay attacks.
The main difficulty of this technique is to give users their passwords
(logistical problem).
This technique is used mainly by services who can afford big infrastructures
(banks, states,...).

\subsubsection{Signatures}
The signature is the encrypted hash of a message.
The hash is a fixed size string built using an irreversible function from a
message.
The signature is then a mean to authenticate the identity of the sender of a
message.

\subsubsection{Challenge}
A challenge use a nonce, this stands for number used once.
It's a random number used once to avoid replay attack.
The nonce is encrypted with the correspondent's public key and he is then
asked for the decrypted and encrypted message.
This form of authentication is often used to sign online transactions.

\subsubsection{Certificates}
A trusted authority issues certificates to confirm the identity of something.
They are used in SSL or TLS.
Only one participant of the conversation can be certified (client or server)
or both.
Certificates are often used as a mean to distribute keys in a PKI. A typical
example is for SSL/TLS in web browsers. A CA is a Certification Authority, an
entity that issues digital certificates.
\begin{itemize}
\item Each CA does generate its public-private key pair. They self-sign their
certificates with their public key
\item Browsers are distributed with some pre-installed certificates. You can
also add them manually
\item When websites want to sign a message, they sign it with their private
key and send the signed object and their certificate
\item The browser checks the certificates against the CA certificate and the
message against the checked certificate
\end{itemize}

\paragraph{How to obtain a certificate ?}
When a website owner wants a certificate, he generates a public-private key
pair and then sends it to a CA.
The CA checks the integrity of the request and performs some checks on the
identity of the owner. Finally, it signs the certificate.

\subsubsection{Token}
Something which ownership gives a form of identification.
For example: Keys, Bank cards, Badges, Digipass, ...

\subsubsection{2-factor authentication}
Identify the entity using multiple authentication methods.
This way, if one method is compromised, the attacker will not still be able to
log into the system.
The authentication methods are the following:
\begin{itemize}
\item What it \emph{is} (biometrics)
\item What it \emph{owns} (bank card,...)
\item What it \emph{knows} (password, pin code,...)
\end{itemize}

\subsection{Single Sign-On}
\begin{quote}
The SSO is a property of access control of multiple related but independent
software systems. With this property a user logs in once and gains access to
all systems without being prompted to log in again for each of them.
-- Wikipedia
\end{quote}

\begin{description}
\item[Pro]
\begin{itemize}
\item Easier for the user
\item Implementation already exist
\item If they have only one password, users tend to treat it with more care
\item Enter the password less often
\end{itemize}
\item[Cons]
\begin{itemize}
\item All your eggs in the same basket (impact greater if compromised)
\item You are dependent upon your provider (confidence, availability,...)
\end{itemize}
\end{description}

\subsection{Kerberos}
Kerberos is a SSO developed at MIT to solve the problem of allowing
some users to use restricted resources. MIT provide a free
implementation of the protocol but it's also found in many commercial
products.

\paragraph{How it works}
\begin{enumerate}
\item The client gets a ticket from a distribution center to authenticate itself
\item The client gets a service ticker
\item The service ticket can be used on another server
\end{enumerate}

\subsection{Provider extensions}
Common SSO used over the web:
\begin{itemize}
\item Facebook account
\item Google
\item OpenID
\end{itemize}
These organisations provide single sign-on to other websites for free
using a dedicated API which is much simpler than devising your own
sign-on mechanism.

\subsection{Compromised authentication}
When you implement authentication you have to take into account that the user
may lose its authentication mean or it can get stolen.

The process is the following:
\begin{enumerate}
\item Deactivate a compromised authentication mean
\item Authenticate the user with a still safe mean
\item Give the user a new primary authentication mean
\end{enumerate}

\subsubsection{Password recovery}
Usability versus security trade-off.
How to do it properly?
\begin{enumerate}
\item Use of security question or other strong authentication
\item Send a token over a side channel
\item Allow the user to change password
\item Confirm change
\end{enumerate}
Beware that an attacker may use social engineering to get answers to security
questions.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Prevention}

\subsection{Different moments}
Preventing security flaws is something that has to be done during the
whole life of the application.

\subsubsection{Architecture}
Integrate a security review into your architecture design process. Start
early on, and as your design changes, review those changes with the
steps given in this chapter.
Evolve your security review. This chapter provides questions that you
can ask to improve the security of your design. To complete the review
process, you might also need to add specific questions that are unique
to your application.
Know the threats you are reviewing against. List the threats that affect the
various components and layers that make up your application.
Knowing these threats is essential to improving the results of your review process.
There are no miracle receipts when it comes to designing a secure
application. Although there are some guidelines which can help you. You
have to ask yourself the good questions and make decisions on a case by
case basis.

Question like:
\begin{itemize}
\item Who are the end-users?
\item In what environment will the application run?
\item Who has access to the data?
\item Are there other systems that access data? What are the rules?
\end{itemize}

\subsubsection{Development}
There are lots of best practices that can make your application more secure.
\begin{itemize}
\item Passwords: enforcing a minimum complexity policy, storing them securely,
having the user rotate them, preventing brute-force by implementing temporary
lock-out,...
\item Session management: setting an inactivity time out, setting the
secure-flag gor sensitive cookies, using the HTTP-Only flag for cookies,
implementing an easily accessible logout,...
\item Input validation: always on server side, use a positive approach
\item Use ad-hoc protection for known attacks. Ad-hoc protection means a
protection specialized for a particular attack in this context
\end{itemize}

However, a secure development cycle should set aside some time for:
\begin{itemize}
\item Code review (security-oriented and general)
\item Pentesting
\item Security training of the developers
\item Sensitizing business owners to security trade-off
\item Choosing a secure and well maintained framework
\item Devising a secure configuration for deployment
\end{itemize}

\subsubsection{Maintenance}
When vulnerabilities have been discovered they have to be patched as soon as
possible. Beware of regressions and new security breaches.

\subsubsection*{Virtual patching}
Virtual patching is a security policy layer that prevents the exploitation of
a known vulnerability until a patch is released.
It does so by filtering the traffic that goes to and from the application
server and blocking requests that are exploits.

\subsubsection{Using frameworks}
You do not develop the first web application. Frameworks already exists to
ease the development of your application while providing several security
mechanisms.
A framework will come generally with authentication support, escaping of
values and standard input validation.
However, when a bug is found in a framework, all the web sites that use the
framework are affected. Changing a framework may prove difficult though.\\

Examples of frameworks: Spring (Java), OWASP which provides an Enterprise
Security API that defines a security API for various languages.

\subsection{Security in application servers}
Application servers offer various services that can help you to configure
secured web applications.

\begin{itemize}
\item Authentication management
\item Directory listing disabling
\item User session management
\item Error handling
\item Input encoding
\end{itemize}

\subsection{Web Application firewall}
Application firewall are filters which inspects the traffic that comes
from and goes to your application and is able to block inappropriate
content.\\
They provide an additional layer of protection, by example, against
SQL injection by scanning HTML form for SQL content.
Also, an application firewall can detect connection patterns (see IDS).
\\
They can be used to patch security holes of applications which aren't
modifiable for some reason (virtual patching).

\subsection{HTTPS}
\textbf{TLS} (Transport Layer Security) is the successor of \textbf{SSL}
(Secured Socket Layer).
They are equal in terms of security.
HTTPS provides \emph{encryption} and \emph{authentication} for HTTP.
\newline Protects against eavesdropping and spoofing.
HTTPS is a part of a solution, it does not ensure full security.
TLS is an open-community standard and allows both secure and unsecure
communications.
\newline TSL~1.0 is equivalent to SSL~3.1

\subsection{Browser restrictions}
Cross-domain XHR: the browsers disallow contacting other websites
through the use of JavaScript. A website can ask for the browser to
lift selectively this restriction via header "Access-Control".\\
Some browsers allow to block (selectively) the execution of Flash and/or
JavaScript to protect the user against malicious code hosted by those sites.
\\
There is also often a "private navigation" mode which prevents the
browser from storing data.\\
Cookies are stored on the user's computer; they are also limited by the URL
and the time stamp.\\
In modern browsers tabs are sandboxed in order to prevent one tab from
accessing data used by others.
\\
Browsers also validate SSL certificates and prompt users when a
dubious certificate is found.\\
Some of them also provide blacklisting of known rogue sites and
correct misspelled addresses to protect users from phishing.

\subsection{E-mail}
E-mail is one of the most used application. It's plagued by spam and
spoofing. Some defensive measure have been taken.

\subsubsection{Sender Policy Framework}
SPF validates e-mails by verifying sender's ip address against DNS records.
Administrators can define allowed hosts.

\subsubsection{Domain Keys Identified Mail}
DKIM associates domain names and email messages using a digital signature
added to the header of messages, a public key is added to the DNS record of
the domain for the recipient to read the message's header.

\subsection{Variety of environments}
The variety of environments available to the users leads to
difficulties when it comes to test possible setups for
vulnerabilities.\\
\begin{itemize}
\item Servers and their configuration
\item Networks (proxy, caches,...)
\item Clients
\item Machine to Machine
\end{itemize}
Moreover some browsers (e.g. IE6) require workarounds to
display pages correctly which extend the amount of code and thus
increase vulnerability likeliness.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Detection}
